<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gesti√≥n de Ciclos Escolares</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_ciclos.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
</head>
<body>

<header class="admin-header">
    <div class="header-left">
        <h1>üìÖ Gesti√≥n de Ciclos Escolares</h1>
    </div>
    <div class="header-right">
        <span>{{ current_user.nombre }}</span>
        <a href="{{ url_for('nom.panel_admin') }}" class="btn-volver">‚Ü© Volver al panel</a>
    </div>
</header>

<main class="crear-usuario-container">
    <section class="formulario-box">

        <!-- üîî Mensajes flash -->
        <div id="flash-container">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>

        <!-- üü¢ Formulario crear ciclo -->
        <form method="POST" class="form-ciclos">
            <input type="text" name="nombre" placeholder="Ej. 2025-2026" required>
            <input type="date" name="fecha_inicio" required>
            <input type="date" name="fecha_fin" required>
            <button type="submit" class="btn btn-primary">‚ûï Crear ciclo</button>
        </form>

        <!-- üìã Tabla de ciclos -->
        <h2 class="subtitulo">Listado de ciclos</h2>
        <div class="tabla-contenedor">
            <table class="tabla-ciclos">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Activo</th>
                        <th>Fechas</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ciclo in ciclos %}
                    <tr id="fila-{{ ciclo.id }}">
                        <td>{{ ciclo.nombre }}</td>
                        <td>
                            {% if ciclo.activo %}
                                <span class="estado activo">‚úîÔ∏è</span>
                            {% else %}
                                <span class="estado inactivo">‚úñÔ∏è</span>
                            {% endif %}
                        </td>
                        <td>{{ ciclo.fecha_inicio }} ‚Äì {{ ciclo.fecha_fin }}</td>
                        <td>
                            {% if not ciclo.activo %}
                                <button class="btn btn-warning" onclick="activarCiclo({{ ciclo.id }})">Activar</button>
                            {% else %}
                                <button class="btn btn-secondary" disabled>Activo</button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</main>

<script>
    // üí® Desvanecer mensajes flash
    setTimeout(() => {
        document.querySelectorAll('.flash').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(-10px)';
            setTimeout(() => el.remove(), 600);
        });
    }, 3000);

    // üü° Activar ciclo con confirmaci√≥n
    async function activarCiclo(id) {
        if (!confirm("¬øSeguro que deseas activar este ciclo escolar? Esto desactivar√° los dem√°s.")) return;

        const resp = await fetch(`/admin/ciclos/activar/${id}`, { method: "POST" });

        if (resp.ok) {
            location.reload();
        } else {
            alert("‚ùå Error al activar el ciclo. Intenta nuevamente.");
        }
    }
</script>

</body>
</html>
