<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Muro de Honor ‚Äì {{ ciclo.nombre }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/public_muro.css') }}">
</head>
<body>

<header class="muro-header">
    <h1>üèÜ Muro de Honor ‚Äì {{ ciclo.nombre }}</h1>
    <form method="get" class="filtros">
        <select name="mes" onchange="this.form.submit()">
            {% for e in eventos %}
                <option value="{{ e.mes_ordinal }}" {% if mes == e.mes_ordinal %}selected{% endif %}>
                    {{ e.nombre_mes }}
                </option>
            {% endfor %}
        </select>

        <select name="tipo" id="tipoSelect" onchange="this.form.submit()">
            <option value="alumno" {% if tipo == 'alumno' %}selected{% endif %}>Alumnos</option>
            <option value="personal" {% if tipo == 'personal' %}selected{% endif %}>Personal</option>
        </select>

        <select name="bloque" id="bloqueSelect" onchange="this.form.submit()">
            <option value="">Todos los bloques</option>
            {% for b in bloques %}
                <option value="{{ b.id }}" {% if bloque_id == b.id %}selected{% endif %}>{{ b.nombre }}</option>
            {% endfor %}
        </select>
    </form>
</header>

<main class="muro-container">
    {% if nominaciones %}
        {% for n in nominaciones %}
            <div class="tarjeta">
                <div class="foto-icono">
                    {% if n.valores|length >= 4 %}
                        üëë
                    {% elif n.valores|length == 3 %}
                        ü•á
                    {% elif n.valores|length == 2 %}
                        ü•à
                    {% else %}
                        ü•â
                    {% endif %}
                </div>

                <!-- ü•á Medalla y n√∫mero de valores -->
                <div class="ranking">
                    {% if n.valores|length >= 4 %}
                        <span class="medalla corona"></span>
                    {% elif n.valores|length == 3 %}
                        <span class="medalla oro"></span>
                    {% elif n.valores|length == 2 %}
                        <span class="medalla plata"></span>
                    {% else %}
                        <span class="medalla bronce"></span>
                    {% endif %}

                    <span class="cantidad">
                        {{ n.valores|length }} {{ 'valor' if n.valores|length == 1 else 'valores' }}
                    </span>
                </div>

                <!-- Nombre -->
                <h2>{{ n.nombre }}</h2>

                <!-- Chips de valores -->
                <p><strong>Valores:</strong>
                    {% for v in n.valores %}
                        <span class="valor-chip">{{ v }}</span>
                    {% endfor %}
                </p>

                {% if n.bloque %}
                <p><strong>Bloque:</strong> {{ n.bloque }}</p>
                {% endif %}

                <small>Evento: {{ n.evento }}</small>
            </div>
        {% endfor %}
    {% else %}
        <p class="sin-resultados">üòÖ No hay nominaciones registradas para los filtros seleccionados.</p>
    {% endif %}
</main>

<footer class="muro-footer">
    <p>¬© {{ ciclo.nombre }} ‚Äì Instituto Moderno Americano</p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const tipoSelect = document.getElementById('tipoSelect');
    const bloqueSelect = document.getElementById('bloqueSelect');

    function toggleBloque() {
        if (tipoSelect.value === 'personal') {
            bloqueSelect.style.display = 'none';
        } else {
            bloqueSelect.style.display = 'inline-block';
        }
    }

    tipoSelect.addEventListener('change', toggleBloque);
    toggleBloque();
});

document.addEventListener('DOMContentLoaded', () => {
  // ===== Scroll autom√°tico con acumulador (px/seg) =====
    const root = document.scrollingElement || document.documentElement;

    // Velocidades en p√≠xeles por segundo
    let speedDown = 30;  // baja la cifra para m√°s lento (p.ej. 8)
    let speedUp   = 50;  // y ajusta la subida si quieres distinta

    let dir = 1;            // 1 = abajo, -1 = arriba
    let paused = false;     // pausa por interacci√≥n
    let last = null;        // timestamp del frame anterior
    let acc = 0;            // acumulador sub-p√≠xel

    // Pausa 10s si se mueve el mouse
    let timer = null;
    document.addEventListener('mousemove', () => {
        paused = true;
        clearTimeout(timer);
        timer = setTimeout(() => paused = false, 10000);
    }, { passive: true });

    function step(ts) {
        if (last == null) last = ts;
        const dt = (ts - last) / 1000; // segundos
        last = ts;

        const max = root.scrollHeight - root.clientHeight;
        if (max > 0 && !paused) {
        // velocidad actual (px/s) seg√∫n direcci√≥n
        const v = dir === 1 ? speedDown : -speedUp;

        // acumula desplazamiento sub-p√≠xel
        acc += v * dt;

        // aplica solo cuando hay al menos 1px acumulado
        const whole = acc | 0; // truncar a entero
        if (whole !== 0) {
            const next = Math.min(max, Math.max(0, root.scrollTop + whole));
            root.scrollTop = next;
            acc -= whole; // conserva la fracci√≥n para el siguiente frame
        }

        // invertir al llegar a extremos
        if (root.scrollTop >= max - 1) dir = -1;
        if (root.scrollTop <= 0)      dir =  1;
        }

        requestAnimationFrame(step);
    }

    requestAnimationFrame(step);

    // Peque√±a ayuda: si todo cabe en pantalla, no hay scroll (opcional)
    // Si quieres forzar movimiento aunque haya poco contenido, duplica temporalmente tarjetas.
});

const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
    });
});
document.querySelectorAll('.tarjeta').forEach(t => observer.observe(t));
</script>

</body>
</html>
