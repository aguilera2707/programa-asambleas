    <!DOCTYPE html>
    <html lang="es">
    <head>
    <meta charset="UTF-8">
    <title>Alumnos del ciclo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_alumnos.css') }}">
    </head>
    <body>
    <div class="container">
        <h1>Alumnos del ciclo {{ ciclo.nombre if ciclo else '‚Äî' }}</h1>

        <!-- üîî Mensajes flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="toast-container">
            {% for category, message in messages %}
                <div class="toast toast-{{ category }}">{{ message }}</div>
            {% endfor %}
            </div>
        {% endif %}
        {% endwith %}

        {% if ciclo %}
        <!-- üîπ Importar alumnos por bloque -->
        <form action="{{ url_for('admin_bp.importar_alumnos_por_bloque') }}" method="POST" enctype="multipart/form-data" class="import-form">
            <select name="bloque_id" required>
            <option value="">‚Äî Selecciona bloque ‚Äî</option>
            {% for b in bloques %}
                <option value="{{ b.id }}">{{ b.nombre }}</option>
            {% endfor %}
            </select>

            <input type="file" name="file" accept=".xlsx,.csv" required>
            <button type="submit">üì§ Importar alumnos</button>
            <a href="{{ url_for('admin_bp.plantilla_alumnos_bloque') }}" class="link-plantilla">üìÑ Descargar plantilla</a>
        </form>

        <h2>Listado de alumnos</h2>
        <table>
            <thead>
            <tr>
                <th>Nombre</th>
                <th>Grado</th>
                <th>Grupo</th>
                <th>Nivel</th>
                <th>Bloque</th>
            </tr>
            </thead>
            <tbody>
            {% for a in alumnos %}
            <tr data-id="{{ a.id }}">
                <td contenteditable="true">{{ a.nombre }}</td>
                <td contenteditable="true">{{ a.grado }}</td>
                <td contenteditable="true">{{ a.grupo }}</td>
                <td contenteditable="true">{{ a.nivel }}</td>
                <td>{{ a.bloque.nombre if a.bloque else '‚Äî' }}</td>
                <td>
                    <button class="btn-guardar">üíæ</button>
                    <button class="btn-eliminar">üóëÔ∏è</button>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="6">No hay alumnos registrados a√∫n.</td></tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="warning">‚ö†Ô∏è No hay un ciclo activo. Activa un ciclo antes de importar alumnos.</p>
        {% endif %}
    </div>

    <script>
        // üí® Desvanecer mensajes autom√°ticamente
        setTimeout(() => {
        document.querySelectorAll('.toast').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(-10px)';
            setTimeout(() => el.remove(), 600);
        });
        }, 3000);

    document.querySelectorAll(".btn-guardar").forEach(btn => {
        btn.addEventListener("click", e => {
            const row = e.target.closest("tr");
            const id = row.dataset.id;
            const datos = {
                nombre: row.cells[0].innerText.trim(),
                grado: row.cells[1].innerText.trim(),
                grupo: row.cells[2].innerText.trim(),
                nivel: row.cells[3].innerText.trim()
            };
            fetch(`/admin/alumnos/editar/${id}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(datos)
            }).then(r => r.json()).then(res => {
                alert(res.message);
            });
        });
    });

    document.querySelectorAll(".btn-eliminar").forEach(btn => {
        btn.addEventListener("click", e => {
            const row = e.target.closest("tr");
            const id = row.dataset.id;
            if (!confirm("¬øEliminar este alumno?")) return;
            fetch(`/admin/alumnos/eliminar/${id}`, { method: "DELETE" })
                .then(r => r.json())
                .then(res => {
                    alert(res.message);
                    row.remove();
                });
        });
    });


    </script>
    </body>
    </html>
