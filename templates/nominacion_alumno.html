<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Nominar Alumno</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nominacion_alumno.css') }}">
</head>
<body>

<header>
    <h2>üè´ Nominaciones de alumnos del ciclo {{ ciclo.nombre }}</h2>
</header>

<main>

    {% if evento %}
    <div class="alert">
        üóìÔ∏è <b>Evento activo:</b> {{ evento.nombre_mes }}  
        <br>
        ‚è≥ <b>Cierre de nominaciones:</b> {{ evento.fecha_cierre_nominaciones.strftime('%d/%m/%Y %H:%M') }}
    </div>
    {% else %}
    <div class="alert" style="background-color:#ffecec; border-color:#ffcaca; color:#6b0000;">
        ‚ö†Ô∏è <b>No hay evento activo actualmente para nominaciones.</b>
    </div>
    {% endif %}

    {% if evento %}
    <form method="POST" class="form-nominacion">
        <label for="alumnos">Selecciona alumno(s):</label>
        <select name="alumnos" id="alumnos" multiple required>
            {% for alumno in alumnos %}
                <option value="{{ alumno.id }}">{{ alumno.nombre }} ({{ alumno.grado }}¬∞{{ alumno.grupo }})</option>
            {% endfor %}
        </select>

        <label for="valor_id">Selecciona el valor:</label>
        <select name="valor_id" id="valor_id" required>
            <option value="">Selecciona un valor</option>
            {% for valor in valores %}
                <option value="{{ valor.id }}">{{ valor.nombre }}</option>
            {% endfor %}
        </select>

        <label for="comentario">Comentario (opcional):</label>
        <input type="text" id="comentario" name="comentario" placeholder="Comentario opcional...">

        <button type="submit" class="btn-registrar">Registrar nominaci√≥n</button>
    </form>
    {% endif %}

    <hr>

    <section class="tabla-nominaciones">
        <h3>üßæ Tus nominaciones registradas</h3>

        {% if nominaciones %}
        <table>
            <thead>
                <tr>
                    <th>Alumno</th>
                    <th>Valor</th>
                    <th>Comentario</th>
                    <th>Fecha</th>
                </tr>
            </thead>
            <tbody>
                {% for n in nominaciones %}
                <tr>
                    <td>{{ n.alumno.nombre }}</td>
                    <td>{{ n.valor.nombre }}</td>
                    <td>{{ n.comentario or '-' }}</td>
                    <td>{{ n.fecha.strftime('%d/%m/%Y') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p><em>No tienes nominaciones registradas a√∫n.</em></p>
        {% endif %}
    </section>

</main>

<!-- ‚úÖ BLOQUEO DE DOBLE SUBMIT -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector("form");
    if (!form) return;

    let enviado = false;

    form.addEventListener("submit", (e) => {
        if (enviado) {
        e.preventDefault();
        return;
        }

        enviado = true;

        const botones = form.querySelectorAll('button[type="submit"], input[type="submit"]');
        botones.forEach(btn => {
        btn.disabled = true;
        if (btn.tagName.toLowerCase() === "button") {
            btn.innerText = "Registrando...";
        }
        });
    });
});
</script>

</body>
</html>
